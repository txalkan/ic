package(default_visibility = ["//ic-os/guestos:__subpackages__"])

exports_files([
    "Dockerfile.base",
    "allow_console_root",
    "extra_boot_args.template",
    "dev-certs/canister_http_test_ca.cert",
    "dev-certs/canister_http_test_ca.key",
    "opt/ic/share/ic.json5.template",
])

# NOTE: These are all of the files available to podman for building, not all of
# these files will end up in the final rootfs.
filegroup(
    name = "rootfs-files",
    srcs = [
        "Dockerfile",
        "docker-base.dev",
        "docker-base.prod",
        "packages.common",
        "packages.dev",
    ] + [
        "dev-certs/canister_http_test_ca.cert",
        "etc/chrony/chrony.conf",
        "etc/crypttab",
        "etc/default/locale",
        "etc/default/node_exporter",
        "etc/filebeat/filebeat.yml.template",
        "etc/fstab",
        "etc/hostname",
        "etc/hosts",
        "etc/initramfs-tools/hooks/veritysetup",
        "etc/initramfs-tools/initramfs.conf",
        "etc/initramfs-tools/modules",
        "etc/initramfs-tools/scripts/init-bottom/set-machine-id",
        "etc/initramfs-tools/scripts/init-premount/verity-root",
        "etc/metrics-proxy.yaml",
        "etc/nftables.conf",
        "etc/node_exporter/node_exporter.crt",
        "etc/node_exporter/node_exporter.key",
        "etc/node_exporter/web.yml",
        "etc/resolv.conf",
        "etc/sudoers",
        "etc/sysctl.d/dfn-max-map-count.conf",
        "etc/sysctl.d/network-tweaks.conf",
        "etc/sysctl.d/privileged-ports.conf",
        "etc/systemd/resolved.conf.d/fallback.conf",
        "etc/systemd/system-generators/mount-generator",
        "etc/systemd/system-generators/systemd-gpt-auto-generator",
        "etc/systemd/system/bootstrap-ic-node.service",
        "etc/systemd/system/filebeat.service",
        "etc/systemd/system/fstrim_tool.service",
        "etc/systemd/system/fstrim_tool.timer",
        "etc/systemd/system/generate-network-config.service",
        "etc/systemd/system/ic-btc-mainnet-adapter.service",
        "etc/systemd/system/ic-btc-mainnet-adapter.socket",
        "etc/systemd/system/ic-btc-testnet-adapter.service",
        "etc/systemd/system/ic-btc-testnet-adapter.socket",
        "etc/systemd/system/ic-crypto-csp.service",
        "etc/systemd/system/ic-crypto-csp.socket",
        "etc/systemd/system/ic-https-outcalls-adapter.service",
        "etc/systemd/system/ic-https-outcalls-adapter.socket",
        "etc/systemd/system/ic-replica.service",
        "etc/systemd/system/ipv4-connectivity-check.service",
        "etc/systemd/system/ipv4-connectivity-check.timer",
        "etc/systemd/system/metrics-proxy.service",
        "etc/systemd/system/monitor-expand-shared-data.service",
        "etc/systemd/system/node_exporter.service",
        "etc/systemd/system/relabel-machine-id.service",
        "etc/systemd/system/reload_nftables.path",
        "etc/systemd/system/reload_nftables.service",
        "etc/systemd/system/retry-ipv6-config.service",
        "etc/systemd/system/save-machine-id.service",
        "etc/systemd/system/serial-getty@.service",
        "etc/systemd/system/setup-encryption.service",
        "etc/systemd/system/setup-fstrim-metrics.service",
        "etc/systemd/system/setup-hostname.service",
        "etc/systemd/system/setup-lvs.service",
        "etc/systemd/system/setup-node-gen-status.service",
        "etc/systemd/system/setup-node_exporter-keys.service",
        "etc/systemd/system/setup-permissions.service",
        "etc/systemd/system/setup-shared-backup.service",
        "etc/systemd/system/setup-shared-crypto.service",
        "etc/systemd/system/setup-shared-data.service",
        "etc/systemd/system/setup-ssh-account-keys.service",
        "etc/systemd/system/setup-ssh-keys.service",
        "etc/systemd/system/upgrade-shared-data-store.service",
        "etc/systemd/system/user@.service",
        "etc/tmpfiles.d/ic-node.conf",
        "etc/udev/rules.d/10-vhost-vsock.rules",
        "opt/ic/bin/bootstrap-ic-node.sh",
        "opt/ic/bin/generate-btc-adapter-config.sh",
        "opt/ic/bin/generate-filebeat-config.sh",
        "opt/ic/bin/generate-https-outcalls-adapter-config.sh",
        "opt/ic/bin/generate-replica-config.sh",
        "opt/ic/bin/ipv4-connectivity-check.sh",
        "opt/ic/bin/manageboot.sh",
        "opt/ic/bin/monitor-expand-shared-data.py",
        "opt/ic/bin/provision-ssh-keys.sh",
        "opt/ic/bin/read-ssh-keys.sh",
        "opt/ic/bin/relabel-machine-id.sh",
        "opt/ic/bin/retry-ipv6-config.sh",
        "opt/ic/bin/save-machine-id.sh",
        "opt/ic/bin/setup-encryption.sh",
        "opt/ic/bin/setup-filebeat-permissions.sh",
        "opt/ic/bin/setup-hostname.sh",
        "opt/ic/bin/setup-lvs.sh",
        "opt/ic/bin/setup-node_exporter-keys.sh",
        "opt/ic/bin/setup-permissions.sh",
        "opt/ic/bin/setup-shared-backup.sh",
        "opt/ic/bin/setup-shared-crypto.sh",
        "opt/ic/bin/setup-shared-data.sh",
        "opt/ic/bin/setup-ssh-account-keys.sh",
        "opt/ic/bin/setup-ssh-keys.sh",
        "opt/ic/bin/setup-var-encryption.sh",
        "opt/ic/bin/upgrade-shared-data-store.sh",
        "opt/ic/bin/validate-replica-config.sh",
        "opt/ic/share/ark.pem",
        "opt/ic/share/ic.json5.template",
        "prep/filebeat/filebeat.fc",
        "prep/filebeat/filebeat.if",
        "prep/filebeat/filebeat.te",
        "prep/fscontext-fixes/fscontext-fixes.fc",
        "prep/fscontext-fixes/fscontext-fixes.if",
        "prep/fscontext-fixes/fscontext-fixes.te",
        "prep/ic-node/ic-node.fc",
        "prep/ic-node/ic-node.if",
        "prep/ic-node/ic-node.te",
        "prep/infogetty/infogetty.fc",
        "prep/infogetty/infogetty.te",
        "prep/manageboot/manageboot.fc",
        "prep/manageboot/manageboot.if",
        "prep/manageboot/manageboot.te",
        "prep/misc-fixes/misc-fixes.if",
        "prep/misc-fixes/misc-fixes.te",
        "prep/node_exporter/node_exporter.fc",
        "prep/node_exporter/node_exporter.if",
        "prep/node_exporter/node_exporter.te",
        "prep/prep.sh",
        "prep/setup-var/setup-var.if",
        "prep/setup-var/setup-var.te",
        "prep/systemd-fixes/systemd-fixes.if",
        "prep/systemd-fixes/systemd-fixes.te",
    ],
    tags = ["manual"],
)
